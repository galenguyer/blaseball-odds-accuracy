<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name=viewport content="width=device-width, initial-scale=1" />
        <meta name="description" content="A quick site to calculate how often the odds given on the blaseball site are correct" />
        <title>Blaseball Odds Accuracy Calculator</title>
        
        <style>
            html,body {
                font-family: Arial, Helvetica, sans-serif;
                text-align: center;
                height: 90%;
            }
            #root {
                position: relative;
                top: 50%;
                transform: translateY(-50%); /* or try 50% */
            }
        </style>
    </head>
    <body>
        <div id='root'>
            <h1>Loading...</h1>
        </div>
        <script>
            function getDataForSeason(season) {
                let totalGames = 0;
                let accurateGames = 0;
                fetch("https://api.sibr.dev/chronicler/v1/games?season=" + season)
                .then(res => res.json())
                .then(data => data.data.filter(game => game.endTime != null))
                .then(data => {
                    totalGames = data.length;
                    data.forEach(game => {
                        let g = game.data;
                        if ((g.homeOdds > g.awayOdds) == (g.homeScore > g.awayScore)) {
                            accurateGames += 1;
                        }
                    });
                })
                .then(() => {
                    let root = document.getElementById('root');
                    root.innerHTML = "";
                    let heading = document.createElement('h2');
                    heading.innerHTML = `Blaseball Odds Accuracy Rate<br/>Season ${season + 1}`;
                    root.append(heading);
                    let rate = document.createElement('h1');
                    rate.innerText = `Accuracy Rate: ${((accurateGames*100)/totalGames).toFixed(1)}%`;
                    root.append(rate);
                    let description = document.createElement('p');
                    description = `Out of ${totalGames} games so far this season, ${accurateGames} were correctly predicted.`;
                    root.append(description);
                });
            }
            fetch("https://cors-proxy.blaseball-reference.com/database/simulationData")
            .then(res => res.json())
            .then(simData => getDataForSeason(simData.season));
        </script>
    </body>
</html>